[%load_template file:"customer/standing_orders/messages.html"/%]
<script type="text/javascript" language="javascript">
function ctinst() {
	var obj = document.getElementById('comment');
	var ct = document.getElementById('ct');
	if(obj && ct) {
		var left = 255-obj.value.length;
		if(left > 0) {
			ct.color= "#333333";
			ct.innerHTML = '<b>'+left+'</b> Characters Left.';
		} else {
			obj.value = obj.value.substring(0,255);
			ct.color= "#CC0000";
			ct.innerHTML = '<b>0</b> Characters Left.';
		}
	}
}
function procorder() {
	var obj = document.ProcOrder.submited; if(obj.value=='1') {
		alert('Please wait. Your order is being processed.');
		return false;
	}
	else {
		obj.value = '1'; return true;
	}
}
function shBalance(chk) {
	var obj=document.getElementById('balance');
	if(obj){
		obj.style.display=(chk?'':'none');
	}
}
</script>
<div class="col-xs-12">
	<div class="row">
		<div class="col-xs-12">
			<h1>Standing Order #[@storder_id@]</h1>
			[%if [@customer_po@]%]
				<h3>Purchase Order Number: [%nohtml%][@customer_po@][%/nohtml%]</h3><br/>
			[%/if%]
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12 col-sm-6">
			<h3>Order Billing Address</h3>
			<p>
				[@bill_first_name@] [@bill_last_name@]<br/>
				[%if [@bill_company@]%]
					[@bill_company@]<br/>
				[%/if%]
				[%if [@bill_street1@]%]
					[@bill_street1@]<br/>
				[%/if%]
				[%if [@bill_street2@]%]
					[@bill_street2@]<br/>
				[%/if%]
				[@bill_city@], [@bill_state_name@] [@bill_zip@]<br/>
				[@bill_country_name@]<br/>
				[@bill_phone@]<br/>
				<a href="[%url page:'account' type:'standing_orders' id:'[@storder_id@]' qs:'action=update_bill_addr&previous=[@current_action@]'/%]" class="btn btn-primary">Change Order Billing Address</a>
			</p>
		</div>
		<div class="col-xs-12 col-sm-6">
			<h3>Order Shipping Address</h3>
			<p>
				[@ship_first_name@] [@ship_last_name@]<br/>
				[%if [@ship_company@]%]
					[@ship_company@]<br/>
				[%/if%]
				[%if [@ship_street1@]%]
					[@ship_street1@]<br/>
				[%/if%]
				[%if [@ship_street2@]%]
					[@ship_street2@]<br/>
				[%/if%]
				[@ship_city@], [@ship_state_name@] [@ship_zip@]<br/>
				[@ship_country_name@]<br/>
				[@ship_phone@]<br/>
				<a href="[%url page:'account' type:'standing_orders' id:'[@storder_id@]' qs:'action=update_ship_addr&previous=[@current_action@]'/%]" class="btn btn-primary">Change Order Shipping Address</a>
			</p>
		</div>
		<div class="col-xs-12">
			<hr/>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<h3>Order Status</h3>
			<p>
				<span class="label [%if [@order_status@] eq 'Active'%]label-success[%elseif [@order_status@] eq 'Inactive' || [@order_status@] like 'waiting approval'%]label-warning[%else%]label-danger[%/if%]">
					[@order_status@]
				</span>
			</p>
			<p>
				Next Delivery: [%format type:'date'%][@date_next@][%/format%]<br/>
				Total Orders: [%format type:'number'%][@total_orders_created@][%/format%]<br/>
				Total Spent: [%format type:'currency'%][@total_money_spent@][%/format%]<br/>
				[%data id:'fulfilled' if:'=' value:'1'%]
					Date Fulfilled: [%format type:'date'%][@date_fulfilled@][%/format%]
				[%/data%]
			</p>
			[%if [@request_to_stop@]%]
				<p class="text-danger"><strong>You've requested to stop this standing order.</strong></p>
			[%/if%]
			<hr/>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<h3>Order Summary</h3>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<form method="post" name="ProcOrder" action="[%url page:'account' type:'standing_orders' id:'[@storder_id@]'/%]" onSubmit="return procorder();">
				<input type="hidden" name="action" value="[@current_action@]">
				<input type="hidden" name="submited" value="0">
				<input type="hidden" name="fn" value="finalize">
				[%standing_order_items id:'[@storder_id@]'%]
					[%param *header%]
						<table class="table">
							<thead>
								<tr>
									<th>SKU</th>
									<th>Product</th>
									<th>QTY</th>
									<th>Price</th>
									<th>Discounts</th>
									<th>Subtotal</th>
								</tr>
							</thead>
							<tbody>
					[%/param%]
					[%param *body%]
						<tr>
							<td>[@sku@]</td>
							<td>[@model@] <i>[@extra@]</i>
								[%if [@aff_id@] eq [@config:aff_rental_id@]%]
									<strong>Rental</strong>
								[%elseif [@aff_id@] eq [@config:aff_ebay_id@]%]
									<br/><strong>eBay ID: [@aff_ref@]</strong>
								[%elseif [@aff_id@] eq [@config:aff_free_id@]%]
									<br/><strong>Free Gift</strong>
								[%/if%]
							</td>
							<td>[@qty@]</td>
							<td>[%format type:'currency'%][@price@][%/format%]</td>
							<td>
								[%if [@discount@]%]
									[%format type:'currency'%]-[@discount@][%/format%]
								[%/if%]
							</td>
							<td>[%format type:'currency'%][@subtotal@][%/format%]</td>
						</tr>
					[%/param%]
					[%param *footer%]
						<tr>
							<td colspan="6" style="text-align:right">
								<strong>Order Subtotal: </strong>[%format type:'currency'%][@product_total@][%/format%]<br/>
								[%if [@fixed_shipping_cost@]%]
									<strong>Total Shipping: </strong>[%format type:'currency'%][@shipping_total@][%/format%]<br/>
								[%/if%]
								[%if [@discount_total@]%]
									<strong>Total Discount: </strong>-[%format type:'currency'%][@discount_total@][%/format%]<br/>
								[%/if%]
								[%if [@surcharge@]%]
									<strong>Surcharge: </strong>[%format type:'currency'%][@surcharge_total@][%/format%] ([%format type:'percent' dc:'2'%][@surcharge_percent@][%/format%])<br/>
								[%/if%]

								[%if [@notax@] eq 0%]
									<strong>GST [%data id:'tax_inc' if:'eq' value:'y' %]Inc[%/data%]: </strong>[%format type:'currency'%][@tax_total@][%/format%]<br/>
								[%/if%]
								<strong>Order Total: </strong>[%format type:'currency'%][@grand_total@][%/format%]
								<input type="hidden" name="grand_total" value="[@grand_total@]"/>
								[%if [@credit_apply@]%]
									<strong>Apply [%format type:'currency'%][@credit_apply@][%/format%] Credit? </strong>
									<input type="checkbox" name="apply_credit" value="[@credit_apply@]" onClick="shBalance(this.checked)"><br/>
									<strong>Balance Due: </strong>[%format type:'currency'%][@owed_total@][%/format%]
								[%/if%]
							</td>
						</tr>
					</tbody>
				</table>
				<hr/>
				<div class="row">
					<div class="col-xs-12 col-sm-6">
						[%if [@shipping_method_id@]%]
							<h3>Delivery Method</h3>
							<p><strong>Delivery Method: </strong>[@shipping_method@]</p>
							[%if [@fixed_shipping_cost@]%]
								<p><strong>Shipping Total: </strong>[%format type:'currency'%][@shipping_total@][%/format%]</p>
							[%/if%]
							<p>
								<strong>Special Delivery Instructions</strong><br/>
								<textarea rows="3" class="form-control" id="comment" name="comment" wrap="soft" onChange="ctinst()" onKeyPress="ctinst()" onBlur="ctinst()">[@ship_comment@]</textarea>
								<span size="1" id="ct"></span>
								<script type="text/javascript" language="javascript">ctinst();</script>
							</p>
							<a href="[%url page:'account' type:'standing_orders' id:'[@storder_id@]' qs:'action=update_shipping'/%]" class="btn btn-primary">Change Delivery Method</a>
						[%/if%]
					</div>
					[%if [@couponcode@]%]
						<div class="col-xs-12 col-sm-6">
							<h3>Special Pricing Arrangements / Discounts</h3>
							<p><strong>Coupon code: </strong>[@couponcode@]</p>
							<p>Special pricing arrangements / discounts will be calculated at time of order.</p>
						</div>
						<div class="col-xs-12">
							<hr/>
						</div>
					[%/if%]
					<div class="col-xs-12 [%if ![@couponcode@]%]col-sm-6[%/if%]">
						<h3>Payment Instructions</h3>
						[%payment_methods id:'[@payment_method@]'%]
							[%param *body%]
								<p><strong>Payment Method: </strong>[@name@]</p>
								<p>
									[%if [@name@] like 'American Express' || [@name@] like 'visa' || [@name@] like 'Master Card' || [@name@] like 'Mastercard'%]
										Your [@name@] will be processed automatically.
									[%/if%]
									[%if [@charge_type@] eq 'cc'%]
										Card Holder: [@card_holder@]<br/>
										Card Number: [@card_number@]</br/>
										Card Expires Date: [@card_exp_month@] / [@card_exp_year@]
									[%/if%]
								</p>
								<a href="[%url page:'account' type:'standing_orders' id:'[@storder_id@]' qs:'action=update_payment&previous=[@current_action@]'/%]" class="btn btn-primary">Change Payment Method</a>
							[%/param%]
							[%param *ifempty%]
								No payment method is selected.
							[%/param%]
						[%/payment_methods%]
					[%/param%]
				[%/standing_order_items%]
				</div>
				</div>
				<div class="row">
					<div class="col-xs-12 text-right">
						<hr/>
						<p>Your order will be processed when clicking "Confirm Order".</p>
						<a href="[%url page:'account' type:'standing_orders' id:'[@storder_id@]' qs:'action=[@previous_action@]'/%]" class="btn btn-lg btn-default">Back</a>
						<button alt="Confirm S/Order Now" class="btn btn-lg btn-success">Confirm Order</button>
					</div>
				</div>
				</form>
			</div>
		</div>
	</div>
